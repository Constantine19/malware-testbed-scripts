#!/usr/bin/env python

import string
import os

def get_dump(ghidra_file, path_name):
    ds_lines = []
    with open(ghidra_file) as f:
        for line in f:
            line = line.strip()
            line = line.split()
            if len(line) > 1:
                if "ds" in line[-2]:
                    if '"' in line[-1]:
                        line[-1] = line[-1].strip('"')
                        ds_lines.append(line[-1])
    if os.path.isfile(path_name + "ghidra_ds_dump"):
        os.remove(path_name + "ghidra_ds_dump")
    f = open(path_name + "ghidra_ds_dump", "w+")
    for item in ds_lines:
        f.write(item + "\n")
    f.close()
    #print ds_lines


def main():
    malware_folders = ['../malware_static/', '../malware_dynamic-static/']
    for malware_dir in malware_folders:
        for all_malware in os.listdir(malware_dir):
            for malware in os.listdir(malware_dir + all_malware + '/'):
                print malware
                path_name = malware_dir + all_malware + '/' + malware + '/'
                for filename in os.listdir(path_name):
                    if filename.endswith("_ghidra"):
                        get_dump(path_name + filename, path_name)

if __name__ == "__main__":
    main()
